/**!
 * $fx.genetics ($DNA)
 *
 * @version 1.0.0-lite
 * @author Joseph Miclaus
 * @license UNLICENSED - see fx.genetics.lite.min.js.LICENSE.txt for details.
 * Copyright (c) 2026 Joseph Miclaus. All rights reserved.
 */
!function(n){"use strict";const author="Joseph Miclaus",t="$fx.genetics",o="1.0.0";if(void 0===n.$fx)throw new Error(`[${t}] $fx not found.`);const e=n.$fx;e.genetics=function(){let n;const r="tiered",c="weighted",f="paired",i=n=>void 0!==n,u=n=>"function"==typeof n,s=n=>"string"==typeof n&&n.length>0,l=n=>"number"==typeof n&&isFinite(n),a=n=>s(n)||l(n)||"boolean"==typeof n;function d(t){return n={t:t,o:r,i:"sliding",u:[],l:new Set,v:[]},v(),b(),y(),function(){if(n.i===f)n.h=[0,0,.125,.125,.25];else n.h=[0,.125,.25]}(),function(){if(n.i===f)n.m=[0,0,.005];else n.m=[0,.005]}(),function(){const t=n.t,o=t.length;for(let e=0;e<o;e++){const o=t[e],r=o.variants;i(o.id)||(o.id="G"+(e+1)),n.u.push(o.id),i(o.name)&&n.l.add(o.name);const c=r.length;let f=0,u=0;for(let n=0;n<c;n++){let t=r[n];a(t)&&(t={value:t},r[n]=t),i(t.chance)?f+=t.chance:u++}if(u>0){const n=(1-f)/u;for(let t=0;t<c;t++){const o=r[t];i(o.chance)||(o.chance=n)}}}}(),d}function v(){const t=n.i,o=n.p;switch(t){case"hybrid":n.A=n=>0===n||o&&n%o===0?[0,0]:[-1,0];break;case f:n.A=n=>n<2?[0,0]:o&&n%o===0?n%2==0?[-1,0]:[-2,0]:n%2==0?[-2,-1]:[-3,-2];break;default:n.A=n=>0===n?[0,0]:1===n||o&&n%o===0?[-1,0]:[-2,-1]}}function b(){if(n.o===c)n.k=[.1875,.046875,.015625];else n.k=[.25,.25,.25]}function y(){let t=n.k;if(n.o!==c){const o=t.length,e=o+1,r=Array(e).fill(0),c=1<<o;for(let n=0;n<c;n++){let c=1;const f=Array.from({length:e},(n,t)=>t);for(let e=o;e>0;e--){const r=e-1;if(n>>o-e&1){const n=f[e];f[e]=f[r],f[r]=n,c*=t[r]}else c*=1-t[r]}r[f[0]]+=c}n.M=r.slice(1),t=n.M}n.S=t.reduce((n,t)=>n+t,0),n.N=1-n.S,Object.defineProperty(d,"primary",{value:n.N,enumerable:!0,configurable:!0})}function w(n){return function(t){const o=n(t);return!l(o)||o<0?0:o>1?1:o}}function g(t){const o=n.h;if(i(o)){const n=o.length;return t<n?o[t]:o[n-1]}return n.O(t)}function h(t){const o=n.m;if(l(o))return o;if(i(o)){const n=o.length;return t<n?o[t]:o[n-1]}return n.J(t)}function m(n,t){const o=e.randAt(t),r=e.randAt(t),c=n.length;let f=0;for(let t=0;t<c;t++)if(f+=n[t].chance,o<f)return n[t];return n[Math.floor(r*c)]}function p(n,t,o,e){const r=new Array(t);for(let c=0;c<t;c++){const t=m(n,e),f={value:t.value};i(t.name)&&(f.name=t.name),o&&(f.preSwapIndex=c),i(t.parentIndex)&&(f.parentIndex=t.parentIndex),t.isMutation&&(f.isMutation=!0),r[c]=f}return r}function A(t){const o={},e=n.t,c=e.length,f=n.o===r,i=n.k.length+1;for(let n=0;n<c;n++){const r=e[n],c=r.id,u=r.variants;o[c]=p(u,i,f,t)}return o}function k(t,o){const r=n.k;for(let n=t.length-1;n>0;n--){const c=n-1,f=r[c];if(e.randAt(o)<f){const o=t[n];t[n]=t[c],t[c]=o}}return t}function M(n,t){if(n.has(t))return!0;if("true"===t)return n.has(!0);if("false"===t)return n.has(!1);const o=Number(t);return!l(o)&&String(o)===t&&n.has(o)}function S(t,o){const r={},c={},f=n.t,u=n.u,s=u.length,l=t.length,a=n.N,d=n.k;for(let n=0;n<l;n++){const o=t[n];for(let t=0;t<s;t++){const e=u[t],r=o[e];i(c[e])||(c[e]=new Map);const f=c[e],s=r.length;for(let t=0;t<s;t++){const o=r[t],e=o.value;f.has(e)||f.set(e,{weight:0,name:o.name,parentIndex:n});const c=0===t?a:d[t-1];f.get(e).weight+=c}}}for(let n=0;n<s;n++){const t=f[n],e=t.id,r=t.mutations;if(!i(r))continue;i(c[e])||(c[e]=new Map);const u=c[e],s=r.length;for(let n=0;n<s;n++){const t=r[n],e=t.value,f=t.requires,s=f.length;let l=0;for(let n=0;n<s;n++){const[t,o]=f[n].split(":"),e=c[t];if(!i(e))break;if(!M(e,o))break;l++}l!==s||u.has(e)||u.set(e,{weight:g(o),name:t.name,isMutation:!0})}}for(let t=0;t<s;t++){const s=u[t],l=c[s];if(!i(l))continue;let a=0;for(const[,n]of l)a+=n.weight;const d=new Array(l.size);let v=0;for(const[n,t]of l){const o={value:n};i(t.name)&&(o.name=t.name),o.chance=t.weight/a,o.parentIndex=t.parentIndex,t.isMutation&&(o.isMutation=!0),d[v]=o,v++}const b=n.k.length+1;r[s]=p(d,b,!1,o);const y=h(o),w=f[t].variants;for(let n=0;n<b;n++)if(!r[s][n].isMutation&&e.randAt(o)<y){const t=m(w,o),e={value:t.value};i(t.name)&&(e.name=t.name),e.isAnomaly=!0,r[s][n]=e}}return r}function N(t,o){const r={},c=n.t,f=n.u.length,u=t.length,s=n.k.length+1,l={};for(let n=0;n<f;n++){const f=c[n].id,a=new Array(u);for(let n=0;n<u;n++)a[n]=k(JSON.parse(JSON.stringify(t[n][f])),o);l[f]=a;const d=new Array(s);for(let n=0;n<s;n++){const t=Math.floor(e.randAt(o)*u),r=a[t][n],c={value:r.value};i(r.name)&&(c.name=r.name),i(r.preSwapIndex)&&(c.preSwapIndex=r.preSwapIndex),c.parentIndex=t,d[n]=c}r[f]=d}const a=h(o),d=g(o);for(let n=0;n<f;n++){const t=c[n],f=t.id,v=t.mutations,b=i(v);let y;if(b){y=Array.from({length:s},()=>[]);const n=v.length;for(let t=0;t<n;t++){const n=v[t],o=n.requires,e=o.length;let r=new Array(e);for(let n=0;n<e;n++){const[t,e]=o[n].split(":");r[n]={id:t,rawValue:e}}for(let t=0;t<s;t++){let o=!0;for(let n=0;n<e;n++){const e=r[n],c=l[e.id];if(!i(c)){o=!1;break}let f=!1;for(let n=0;n<u;n++){const o=c[n][t].value;if(M(new Set([o]),e.rawValue)){f=!0;break}}if(!f){o=!1;break}}o&&y[t].push(n)}}}const w=t.variants;for(let n=0;n<s;n++){const t=b&&y?y[n]:[],c=t.length>0&&e.randAt(o)<d,u=e.randAt(o)<a;if(!c&&!u)continue;const s=r[f][n];let l;if(c){l=t[Math.floor(e.randAt(o)*t.length)]}else u&&(l=m(w,o));const v={value:l.value};i(l.name)&&(v.name=l.name),v.preSwapIndex=s.preSwapIndex,c?v.isMutation=!0:u&&(v.isAnomaly=!0),r[f][n]=v}}return r}function O(t){const o=n.A(t),c=o.length,f=[];for(let e=0;e<c;e++){const r=o[e];if(0===r)f.push(A(t));else if(r<0){const o=t+r;o<0?f.push(A(t)):f.push(n.v[o].genome)}}return{id:e.lineage[t],genome:n.o===r?N(f,t):S(f,t),parents:f}}function x(t){const o=n.v[e.depth].genome[t];if(i(o))return o}function J(t){const o=n.t,e=o.length;for(let n=0;n<e;n++){const e=o[n];if(e.name===t)return x(e.id)}}function $(n){const t=x(n);if(i(t))return t[0]}function j(t,o){const r=n.v[e.depth].parents[o];if(!i(r))return;const c=r[t];return i(c)?c:void 0}function G(t,o){const e=n.t,r=e.length;for(let n=0;n<r;n++){const r=e[n];if(r.name===t)return j(r.id,o)}}function I(n,t){if(t&&n.startsWith("#")){return[n.slice(1),!0]}return[void 0,!1]}return Object.defineProperty(d,"version",{value:o,enumerable:!0}),d.mode=function(t){return n.o=t,b(),y(),d},d.parents=function(t,o){var e;return s(t)?(i(o)&&(n.p=o),n.i=t,v()):u(t)&&(n.i="custom",n.A=(e=t,function(n){const t=e(n);return o=t,Array.isArray(o)&&2===o.length&&Number.isInteger(o[0])&&Number.isInteger(o[1])&&o[0]<=0&&o[1]<=0?t:[0,0];var o})),d},d.hidden=function(t){return n.k=t,y(),d},d.mutations=function(t){return Array.isArray(t)&&t.length>0?(n.h=t,n.O=void 0):u(t)&&(n.h=void 0,n.O=w(t)),d},d.anomalies=function(t){return Array.isArray(t)&&t.length>0&&(n.m=t,n.J=void 0),l(t)&&t>=0&&t<=1?(n.m=t,n.J=void 0):u(t)&&(n.m=void 0,n.J=w(t)),d},d.evolve=function(){const t=n.v,o=e.depth;for(let n=0;n<=o;n++)e.randAt.reset(n),t.push(O(n)),e.randAt.reset(n);const r={},c=n.t,f=c.length;for(let n=0;n<f;n++){const t=c[n];if(!1!==t.exposed){const n=t.id,o=$(n);if(i(o)){const e=t.name;r[i(e)?e:n]=i(o.name)?o.name:o.value}}}e.features(r)},d.getSchema=function(){return n.t},d.getLineage=function(){return n.v},d.getGenome=function(t=e.depth){return function(t=e.depth){return n.v[t].genome}(t)},d.getGenotype=function(n){const t=s(n),[o,e]=I(n,t);if(t)return e?x(o):J(n)},d.getPhenotype=function(n){const t=s(n),[o,e]=I(n,t);if(t)return e?$(o):function(n){const t=J(n);return i(t)?t[0]:void 0}(n)},d.getTrait=function(n){return d.getPhenotype(n)},d.getParentGenome=function(t,o=e.depth){return n.v[o].parents[t]},d.getParentGenotype=function(n,t){const o=s(n),[e,r]=I(n,o);if(o)return r?j(e,t):G(n,t)},d.getParentPhenotype=function(n,t){const o=s(n),[e,r]=I(n,o);if(o)return r?function(n,t){const o=j(n,t);return i(o)?o[0]:void 0}(e,t):function(n,t){const o=G(n,t);return i(o)?o[0]:void 0}(n,t)},d.getParentTrait=function(n,t){return d.getParentPhenotype(n,t)},d.getHiddenToPrimaryChances=function(){if(n.o===r)return n.M},d.getMutationChance=function(n=e.depth){return g(n)},d.getAnomalyChance=function(n=e.depth){return h(n)},d.toString=function(){return t+" v"+o+" (by "+author+")"},d}(),n.$DNA=e.genetics}("undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:this);